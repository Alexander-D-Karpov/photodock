{{define "admin/photos.html"}}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - PhotoDock</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
<div class="admin-container">
    <nav class="admin-nav">
        <a href="/admin">{{template "icon-home"}} Dashboard</a>
        <a href="/admin/folders">{{template "icon-folder-small"}} Folders</a>
        <a href="/admin/photos" class="active">{{template "icon-image"}} Photos</a>
        <a href="/" target="_blank">{{template "icon-external"}} View Site</a>
    </nav>

    <main class="admin-main">
        <div class="page-header">
            <h1>Photos</h1>
            <span class="count">{{.TotalCount}} total</span>
        </div>

        <div class="filters">
            <form method="GET" class="filter-form">
                <div class="search-box">
                    <input type="text" name="q" id="search-input" placeholder="Search photos..." value="{{.SearchQuery}}">
                    <button type="button" class="btn btn-small" onclick="performSearch()">{{template "icon-scan"}} Search</button>
                </div>
                <select name="folder" onchange="this.form.submit()">
                    <option value="">All Folders</option>
                    <option value="root" {{if eq .FolderFilter "root"}}selected{{end}}>Root Only</option>
                    {{range .Folders}}
                    <option value="{{.ID}}" {{if eq $.FolderFilter (printf "%d" .ID)}}selected{{end}}>{{.Path}}</option>
                    {{end}}
                </select>
                <label class="checkbox-label">
                    <input type="checkbox" name="hidden" value="1" {{if .ShowHidden}}checked{{end}} onchange="this.form.submit()">
                    Show Hidden
                </label>
            </form>
        </div>

        <div class="bulk-actions" id="bulk-actions">
            <span><strong id="selected-count">0</strong> selected</span>
            <button class="btn btn-small" onclick="bulkHide()">{{template "icon-eye-off"}} Hide</button>
            <button class="btn btn-small" onclick="bulkMove()">{{template "icon-folder-small"}} Move</button>
            <button class="btn btn-small btn-danger" onclick="bulkDelete()">{{template "icon-trash"}} Delete</button>
        </div>

        <div class="photos-admin-grid">
            {{range .Photos}}
            <div class="photo-admin-card {{if .Hidden}}hidden-photo{{end}}" data-id="{{.ID}}">
                <div class="photo-select-wrapper">
                    <input type="checkbox" class="photo-select" data-id="{{.ID}}" onchange="togglePhotoSelect({{.ID}}, this)">
                </div>
                <a href="/admin/photos/{{.ID}}">
                    <img src="/thumb/small/{{.ID}}" alt="{{.Filename}}" loading="lazy">
                </a>
                <div class="photo-admin-info">
                    <span class="filename">{{if .Title.Valid}}{{.Title.String}}{{else}}{{.Filename}}{{end}}</span>
                    <div class="photo-admin-actions">
                        <button class="btn-icon" onclick="toggleHide({{.ID}})" title="{{if .Hidden}}Show{{else}}Hide{{end}}">
                            {{if .Hidden}}{{template "icon-eye"}}{{else}}{{template "icon-eye-off"}}{{end}}
                        </button>
                        <button class="btn-icon btn-danger" onclick="deletePhoto({{.ID}})" title="Delete">
                            {{template "icon-trash"}}
                        </button>
                    </div>
                </div>
            </div>
            {{end}}
        </div>

        {{if gt .TotalPages 1}}
        <div class="pagination">
            {{if gt .CurrentPage 1}}
            <a href="?page={{sub .CurrentPage 1}}{{if .FolderFilter}}&folder={{.FolderFilter}}{{end}}{{if .ShowHidden}}&hidden=1{{end}}{{if .SearchQuery}}&q={{.SearchQuery}}{{end}}" class="btn">Previous</a>
            {{end}}
            <span class="page-info">Page {{.CurrentPage}} of {{.TotalPages}}</span>
            {{if lt .CurrentPage .TotalPages}}
            <a href="?page={{add .CurrentPage 1}}{{if .FolderFilter}}&folder={{.FolderFilter}}{{end}}{{if .ShowHidden}}&hidden=1{{end}}{{if .SearchQuery}}&q={{.SearchQuery}}{{end}}" class="btn">Next</a>
            {{end}}
        </div>
        {{end}}
    </main>

    <dialog id="move-dialog" class="admin-dialog">
        <h2>Move Photos</h2>
        <div class="form-group">
            <label for="move-folder">Destination Folder</label>
            <select id="move-folder">
                <option value="">Root</option>
                {{range .Folders}}
                <option value="{{.ID}}">{{.Path}}</option>
                {{end}}
            </select>
        </div>
        <div class="dialog-actions">
            <button type="button" class="btn" onclick="this.closest('dialog').close()">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="confirmBulkMove()">Move</button>
        </div>
    </dialog>
</div>
<script src="/static/js/admin.js"></script>
</body>
</html>
{{end}}